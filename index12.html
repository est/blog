<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Est's Blog</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Est's Blog </a></h1>
                <nav><ul>
                    <li><a href="/category/photo.html">photo</a></li>
                    <li><a href="/category/stderr.html">stderr</a></li>
                    <li><a href="/category/stdin.html">stdin</a></li>
                    <li><a href="/category/text.html">text</a></li>
                </ul></nav>
        </header><!-- /#banner -->

                <section id="content" class="body">
                    <ol id="posts-list" class="hfeed" start="9">
            <li><article class="hentry">
                <header>
                    <h1><a href="/post/47007003400" rel="bookmark"
                           title="Permalink to Google Spreadsheet API pitfalls">Google Spreadsheet API pitfalls</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-04-03T02:41:00+00:00">
                Published: Wed 03 April 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/estblog.html">estblog</a>
        </address>
<p>In <a href="/category/text.html">text</a>.</p>
<p>tags: <a href="/tag/google.html">google</a> <a href="/tag/pitfall.html">pitfall</a> <a href="/tag/api.html">api</a> </p>
</footer><!-- /.post-info -->                <ol>
<li>
<p>Don't use OAuth 2 for "Google Apps for Business", coz admin may set share option to "limit to xxx domain only", thus your poor nigga API account like "30000000000@developer.gserviceaccount.com" won't work.</p>
</li>
<li>
<p>Google Spreadsheets' CSV output format is terrible shit. Never bother touch it. It does not handle …</p></li></ol>
                <a class="readmore" href="/post/47007003400">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/post/46935375645" rel="bookmark"
                           title="Permalink to OS X Mountain Lion 修改 openssh sshd_config 配置">OS X Mountain Lion 修改 openssh sshd_config 配置</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-04-02T09:52:47+00:00">
                Published: Tue 02 April 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/estblog.html">estblog</a>
        </address>
<p>In <a href="/category/text.html">text</a>.</p>
<p>tags: <a href="/tag/osx.html">osx</a> </p>
</footer><!-- /.post-info -->                <p>OS X的蛋痛特性是  <code>`launched</code> 。如果你需要修改sshd的监听端口，那么</p>
<p>编辑 /System/Library/LaunchDaemons/ssh.plist </p>
<div class="highlight"><pre><span></span>        &amp;lt;key&amp;gt;Listeners&amp;lt;/key&amp;gt;
        &amp;lt;dict&amp;gt;
                &amp;lt;key&amp;gt;SockServiceName&amp;lt;/key&amp;gt;
                &amp;lt;string&amp;gt;ssh-alt&amp;lt;/string&amp;gt;
        &amp;lt;/dict&amp;gt;
</pre></div>


<p>然后在<code>/etc/services</code>里定义：</p>
<div class="highlight"><pre><span></span> ssh-alt 12345/tcp # ssh-alt
</pre></div>


<p>然后重启sshd服务：</p>
<div class="highlight"><pre><span></span>sudo launchctl uload …</pre></div>
                <a class="readmore" href="/post/46935375645">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/post/46390709551" rel="bookmark"
                           title="Permalink to HAProxy like zero-copy in Python with memoryview">HAProxy like zero-copy in Python with memoryview</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-03-26T22:39:00+00:00">
                Published: Tue 26 March 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/estblog.html">estblog</a>
        </address>
<p>In <a href="/category/text.html">text</a>.</p>
<p>tags: <a href="/tag/python.html">python</a> <a href="/tag/networking.html">networking</a> <a href="/tag/socket.html">socket</a> </p>
</footer><!-- /.post-info -->                <p>开篇帖子侃一下HAProxy这个神器有什么神器之处。</p>
<p><a href="http://xiaoxia.org/2011/03/29/written-by-python-socks5-server/">写过proxy的人</a>都会写类似的语句：</p>
<div class="highlight"><pre><span></span>localstream.write(upstream.read(1024))
upstream.write(localstream.read(1024))
</pre></div>


<p>其中1024为业界良心艹榴网的chunk或者一个buffer size。这样的操作在各种router, proxy, firewall 里太常见了。</p>
<p>那么HAProxy有什么<a href="http://stackoverflow.com/a/2120295/41948">特别的地方</a>呢？秘密就是，上游socket的接受buffer和本地socket的发送buffer为同一块内存。也就是说，上游socket数据来了，本地socket自动发送这一块buffer的数据。效率真是高爆了。这块buffer数据还可以用内核调用<code>splice()</code> 和 <code>tee()</code> 来达到分流和分离信号的目的。</p>
<p>btw sendfile() 是不行的，源必须是可以mmap的buffer，目标必须是个socket。</p>
<p>那么弱爆了的python可否跪舔这种高级特性呢？2.7和3.X里是可以的，因为现在PEP 3118统一了各种streaming object 的buffer protocol。只需要用一个<a href="http://docs.python.org/2/library/stdtypes.html#memoryview">叫memoryview的引用</a>
就可以实现共享buffer而达到zero-copy的目的了 …</p>
                <a class="readmore" href="/post/46390709551">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/post/46316452252" rel="bookmark"
                           title="Permalink to GOOG 的生态系统已经完了。欢迎来到私家花园">GOOG 的生态系统已经完了。欢迎来到私家花园</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-03-26T00:48:33+00:00">
                Published: Tue 26 March 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/estblog.html">estblog</a>
        </address>
<p>In <a href="/category/text.html">text</a>.</p>
<p>tags: <a href="/tag/google.html">google</a> <a href="/tag/web.html">web</a> </p>
</footer><!-- /.post-info -->                <p>两个事情需要喷一下：</p>
<ol>
<li>
<p>G+团队的官方博客：<a href="http://gplusproject.appspot.com/new-apps-iphone-android">http://gplusproject.appspot.com/new-apps-iphone-android</a> 这是个什么jb飞机玩意？为啥不<a href="http://googleplusplatform.blogspot.com/">用blogger</a>?</p>
</li>
<li>
<p>看这个关于代码测试的google官方博客 <a href="http://googletesting.blogspot.sg/2013/03/testing-on-toilet-testing-state-vs.html">http://googletesting.blogspot.sg/2013/03/testing-on-toilet-testing-state-vs.html</a> 用它妈这么多javascript特效干嘛？关键是——禁用了js之后，页面就一片空白了。</p>
</li>
</ol>
<p>欢迎来到后web 2.0时代——没有首页，没有订阅，没有js就神马都不显示的web app时代。</p>
                <a class="readmore" href="/post/46316452252">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/post/45915290071" rel="bookmark"
                           title="Permalink to day -1">day -1</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-03-21T11:12:00+00:00">
                Published: Thu 21 March 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/estblog.html">estblog</a>
        </address>
<p>In <a href="/category/text.html">text</a>.</p>
<p>tags: <a href="/tag/wall.html">wall</a> </p>
</footer><!-- /.post-info -->                <p>day -3 observed performance downgrade when x-linking sites <br>
day -2 frustrated at tcp blackout <br>
day -1 punched the hole and see the light <br>
day 0 productivity.</p>
                <a class="readmore" href="/post/45915290071">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/post/45326795197" rel="bookmark"
                           title="Permalink to RIP Google Reader">RIP Google Reader</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-03-14T01:05:49+00:00">
                Published: Thu 14 March 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/estblog.html">estblog</a>
        </address>
<p>In <a href="/category/text.html">text</a>.</p>
<p>tags: <a href="/tag/google.html">Google</a> </p>
</footer><!-- /.post-info -->                <p><img alt="" src="http://media.tumblr.com/4dd9f2766171562258e0afcadd6cbb4a/tumblr_inline_mjmwt5sxqC1qz4rgp.png"></p>
<p>It was fun while it lasted.</p>
<p>FUCK GOOG</p>
                <a class="readmore" href="/post/45326795197">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/post/45245208546" rel="bookmark"
                           title="Permalink to Unix Socket 点滴[转载]">Unix Socket 点滴[转载]</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-03-12T23:49:00+00:00">
                Published: Tue 12 March 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/estblog.html">estblog</a>
        </address>
<p>In <a href="/category/text.html">text</a>.</p>
<p>tags: <a href="/tag/socket.html">socket</a> </p>
</footer><!-- /.post-info -->                <p>【Unix Socket 点滴 1】使用unix socket时，把路径名的第一个字节设为null byte（\x00），这样就不会产生实际的文件，使用起了比较方便，也不用纠结选哪个路径，随便一个字符串就行了。netstat的时候会发现，第一个字节变成了蜗牛符号</p>
<p><img alt="" src="http://ww4.sinaimg.cn/large/622a9970gw1e2g8r9fny2j.jpg"></p>
<p>【Unix Socket 点滴 2】unix socket的DGRAM模式可以传输大数据块，而UDP单个包最大65507字节。</p>
<p>【Unix Socket 点滴 3】unix socket可以发送文件句柄。特别是大数据量交互的时候可以放在tmpfs共享内存，只把文件句柄发送过去，这样可以做到0-copy。</p>
<p>【Unix Socket 点滴 4】unix socket可以校验对端的uid和pid，这在某些场合下是一种可依赖的鉴权手段。</p>
<p>【Unix Socket 点滴 5】uninx DGRAM句柄在对端关闭时，会自动解除连接关系，端口变成unconnect状态，后续使用可以重新connect。</p>
<p>来自 <a href="http://weibo.com/codebox">CodeBox-腾讯</a> 腾讯云平台资深还是浅就那么回事儿工程师 …</p>
                <a class="readmore" href="/post/45245208546">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/post/45176433551" rel="bookmark"
                           title="Permalink to Web服这个屎盆子不够装了——记inetd的现代版Mozilla Circus">Web服这个屎盆子不够装了——记inetd的现代版Mozilla Circus</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-03-12T02:55:00+00:00">
                Published: Tue 12 March 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/estblog.html">estblog</a>
        </address>
<p>In <a href="/category/text.html">text</a>.</p>
<p>tags: <a href="/tag/python.html">python</a> <a href="/tag/web.html">web</a> <a href="/tag/stack.html">stack</a> <a href="/tag/wsgi.html">wsgi</a> </p>
</footer><!-- /.post-info -->                <p>今天瞄了下<a href="circus.rtfd.org">Mozilla Circus</a>这个项目，黑有意思。</p>
<p>简单的说，目前Web服务器基本模型都是一个总瓢把子Nginx，后边一大堆苦力worker进程。比如Python世界的Gunicorn是这个样子的粗暴简单：</p>
<p><img alt="" src="http://circus.readthedocs.org/en/0.5/_images/classical-stack.png"></p>
<p>worker基本都是日出而耕，日落而息。（顺便一喷，Supervisord这些都弱爆了。djb大牛的<a href="https://news.ycombinator.com/item?id=5346871">runit</a>才是王道）</p>
<p>要做到聪明的运维，和可小可大硬又黑的HA scaling，就需要一个高级一点的worker进程管理器于是——哐当当，Mozilla的Circus闪亮登场！</p>
<p><img alt="" src="http://circus.readthedocs.org/en/0.5/_images/circus-stack.png"></p>
<p>中文介绍在这里<a href="https://github.com/PyCodersCN/PyCodersCN/blob/master/issue16/mongrel2-amp-circus-full-control-of-your-web-stack.rst">Mongrel2&amp;Circul = web栈的完全控制</a></p>
<p>我觉得这项目很不错，至少有了Web Console码农不用再去砸400多元的机械键盘去 <code>kill -HUP</code>和 <code>cat pidfile</code> 啪啪啪了</p>
<p>但是Circus只这样就太大材小用了。都进程了，那么<a href="http://blog.ziade.org/2012/06/12/shared-sockets-in-circus/">socket、fd也一并托管了</a>吧。以后业务逻辑就只管去轮fd就是了。这就是<a href="https://stripe.com/blog/meet-einhorn">einhorn</a>项目的思路。</p>
<p>同时我突然觉得Mongrel2这个项目有点2，居然是用json把http完整序列化一遍再pubsub分发到处理点。。。。这效率。。</p>
<p>Circus的让我想起uWSGI。大部分 …</p>
                <a class="readmore" href="/post/45176433551">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/post/44824022057" rel="bookmark"
                           title="Permalink to yes, wsgi is such pain in the ass">yes, wsgi is such pain in the ass</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-03-07T20:13:52+00:00">
                Published: Thu 07 March 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/estblog.html">estblog</a>
        </address>
<p>In <a href="/category/text.html">text</a>.</p>
<p>tags: <a href="/tag/python.html">python</a> <a href="/tag/gevent.html">gevent</a> <a href="/tag/async.html">async</a> </p>
</footer><!-- /.post-info -->                <p>found this <a href="http://lucumr.pocoo.org/2011/7/27/the-pluggable-pipedream/">gem</a></p>
<blockquote>
<p>While it is indeed now possible to utilize greenlets to convert multiple function calls into yields in a generator, it's still something you would not do.</p>
<p>In general JSON via HTTP or zeromq is so much cooler and more flexible than WSGI could ever be.</p>
</blockquote>
<p><a href="http://uwsgi-docs.readthedocs.org/en/latest/Gevent.html">Gevent</a> is …</p>
                <a class="readmore" href="/post/44824022057">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/post/44748163383" rel="bookmark"
                           title="Permalink to tf2上最尽职尽责的医生了吧。。。">tf2上最尽职尽责的医生了吧。。。</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-03-06T20:14:03+00:00">
                Published: Wed 06 March 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/estblog.html">estblog</a>
        </address>
<p>In <a href="/category/text.html">text</a>.</p>
<p>tags: <a href="/tag/game.html">game</a> <a href="/tag/video.html">video</a> </p>
</footer><!-- /.post-info -->                <iframe width="640" height="360" src="http://www.youtube.com/embed/yiLFj73yjYQ?feature=player_detailpage" frameborder="0" allowfullscreen></iframe>

<p>坚持不懈在悬崖上依然勇于奉献无私给奶的好奶爸！在最后关键60秒获得了关键胜利！</p>
                <a class="readmore" href="/post/44748163383">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
<p class="paginator">
        <a href="/index11.html">&laquo;</a>
    Page 12 / 26
        <a href="/index13.html">&raquo;</a>
</p>
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>